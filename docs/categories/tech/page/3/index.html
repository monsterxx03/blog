<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" >
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>Tech | Shining Moon</title>


<link rel="stylesheet" href="/css/style.css"/><link rel='stylesheet' href='https://blog.monsterxx03.com/css/custom.css'><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
</head>
<body>


<section class="section">
  <div class="container">
    <nav class="nav">
      <div class="nav-left">
        <a class="nav-item" href="https://blog.monsterxx03.com"><h1 class="title is-4">Shining Moon</h1></a>
      </div>
      <div class="nav-right">
        <nav class="nav-item level is-mobile"><a class="level-item" aria-label="config" href='#ZgotmplZ' target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="email" href='mailto:xyj.asmy@gmail.com' target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
    <polyline points="22,6 12,13 2,6"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="github" href='https://github.com/monsterxx03' target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="linkedin" href='https://linkedin.com/in/%e5%be%90-%e5%8f%b6%e4%bd%b3-43564554' target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path stroke-width="1.8" d="m5.839218,4.101561c0,1.211972 -0.974141,2.194011 -2.176459,2.194011s-2.176459,-0.982039 -2.176459,-2.194011c0,-1.211094 0.974141,-2.194011 2.176459,-2.194011s2.176459,0.982917 2.176459,2.194011zm0.017552,3.94922l-4.388022,0l0,14.04167l4.388022,0l0,-14.04167zm7.005038,0l-4.359939,0l0,14.04167l4.360816,0l0,-7.370999c0,-4.098413 5.291077,-4.433657 5.291077,0l0,7.370999l4.377491,0l0,-8.89101c0,-6.915523 -7.829986,-6.66365 -9.669445,-3.259423l0,-1.891237z"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="twitter" href='https://twitter.com/monsterxx03' target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
    
  </svg></i>
            </span>
          </a></nav>
      </div>
    </nav>

    <nav class="nav">
      

      
    </nav>

  </div>
</section>

<section class="section">
  <div class="container">
    
    
    <article>
      <div class="subtitle tags is-6 is-pulled-right">
        
        
<a class="subtitle is-6" href="/tags/glow">#glow</a>



        
      </div>
      <h2 class="subtitle is-6">July 1, 2017</h2>
      <h1 class="title"><a href="https://blog.monsterxx03.com/2017/07/01/python-web-%E5%BA%94%E7%94%A8%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/">Python Web åº”ç”¨æ€§èƒ½è°ƒä¼˜</a></h1>
      <div class="content">
        Python web åº”ç”¨æ€§èƒ½è°ƒä¼˜ ä¸ºäº†å¿«é€Ÿä¸Šçº¿ï¼Œæ—©æœŸå¾ˆå¤šä»£ç åŸºæœ¬æ˜¯æ€ä¹ˆæ–¹ä¾¿æ€ä¹ˆæ¥ï¼Œè¿™æ ·å°±ç•™ä¸‹äº†å¾ˆå¤šéšæ‚£ï¼Œæ€§èƒ½ä¹Ÿä¸æ˜¯å¾ˆç†æƒ³ï¼Œpython å› ä¸º GIL çš„åŸå› ï¼Œåœ¨æ€§èƒ½ä¸Šæœ‰å¤©ç„¶åŠ£åŠ¿ï¼Œå³ä½¿ç”¨äº† gevent/eventlet è¿™ç§åç¨‹æ–¹æ¡ˆï¼Œä¹Ÿå¾ˆå®¹æ˜“å› ä¸ºè€—æ—¶çš„ CPU æ“ä½œé˜»å¡ä½æ•´ä¸ªè¿›ç¨‹ã€‚å‰é˜µå­å¯¹åŸºç¡€ä»£ç åšäº†äº›é‡æ„ï¼Œæ•ˆæœæ˜¾è‘—ï¼Œè®°å½•ä¸€äº›ã€‚
è®¾å®šç›®æ ‡:
 æ€§èƒ½æé«˜äº†ï¼Œæœ€ç›´æ¥çš„æ•ˆæœå½“ç„¶æ˜¯èƒ½ç”¨æ›´å°‘çš„æœºå™¨å¤„ç†ç›¸åŒæµé‡ï¼Œç›®æ ‡æ˜¯å…³é—­ 20% çš„ stateless webserver. å°½é‡åœ¨æ¡†æ¶ä»£ç ä¸Šåšæ”¹åŠ¨ï¼Œä¸åŠ¨ä¸šåŠ¡é€»è¾‘ä»£ç ã€‚ ä½é£é™© (å†å²ç»éªŒå‘Šè¯‰æˆ‘ä»¬ï¼ŒåŠ¨æ€ä¸€æ—¶çˆ½ï¼Œé‡æ„ç«è‘¬åœº&hellip;.)  æ²»æ ‡ å¸¸è§åœºæ™¯æ˜¯å¤§å®¶å¼€å¼€å¿ƒå¿ƒåšå®Œä¸€ä¸ª featureï¼Œ sandbox æµ‹è¯•ä¹Ÿæ²¡å•¥é—®é¢˜ï¼Œä¸Šçº¿äº†ï¼Œç»“æœ server load é£™å‡ï¼Œå„ç§ timeout éƒ½æ¥äº†ï¼Œè¦ä¹ˆ rollback ä»£ç ï¼Œè¦ä¹ˆåŠ æœºå™¨ã€‚é—®é¢˜ä»£ç åœ¨å“ª?
æˆ‘ä»¬ç›‘æ§ç”¨çš„æ˜¯ datadog (statsdåè®®)ï¼Œå¯¹è¿™ç§é—®é¢˜æœ€æœ‰æ•ˆçš„æŒ‡æ ‡æ˜¯çœ‹æ¯ä¸ªæ¥å£çš„ avg_latency * req_count å¾—åˆ°æ¯ä¸ªæ¥å£åœ¨ä¸€æ®µæ—¶é—´å†…çš„æ€»è€—æ—¶ï¼Œåœ¨æŸ±çŠ¶å›¾ä¸Šæœ€é•¿çš„é‚£å—å°±æ˜¯å¯¹æ€§èƒ½å½±å“æœ€å¤§çš„æ¥å£ã€‚è¿›ä¸€æ­¥çš„è°ƒè¯•å°±é  cProfile å’Œè¯»ä»£ç äº†ã€‚
ä½†å¾ˆå¤šæ—¶å€™å‡ºé—®é¢˜çš„ä»£ç é€»è¾‘å·¨å¤æ‚ï¼Œè¿˜å¾ˆå¤šäººæ”¹åŠ¨è¿‡ï¼Œå¼€å‘å’Œ sandbox ç¯å¢ƒæ•°æ®çš„é‡å’Œçº¿ä¸Šå·®è·å¤ªå¤§ï¼Œæ— æ³•å¤ç°é—®é¢˜ï¼Œåœ¨çº¿ä¸Šç”¨ cProfile åªèƒ½æµ‹åªè¯»æ¥å£(ä¸ºäº†ä¸å†™åç”¨æˆ·æ•°æ®)ã€‚
è€Œä¸”è¿™ç§æ–¹å¼åªèƒ½æ²»æ ‡ï¼Œè°ƒè¯•ä¸ªåˆ«æ…¢çš„ä¸šåŠ¡æ¥å£ï¼Œç›®æ ‡é‡Œè¯´äº†åªæƒ³æ”¹æ¡†æ¶ï¼Œæé«˜æ•´ä½“æ€§èƒ½ï¼Œæ€ä¹ˆæ•´?
æ²»æœ¬ æˆ‘å¸Œæœ›èƒ½å¯¹è¿è¡Œæ—¶è¿›ç¨‹çŠ¶æ€æ‰“ snapshotï¼Œæ¯æ¬¡å¿«ç…§è®°å½•ä¸‹å½“å‰çš„å‡½æ•°è°ƒç”¨æ ˆï¼Œå åˆå¤šæ¬¡é‡‡æ ·ï¼Œå‡ºç°æ¬¡æ•°å¤šçš„å‡½æ•°å¿…ç„¶å°±æ˜¯ç“¶é¢ˆæ‰€åœ¨. è¿™æ€æƒ³åœ¨å…¶ä»–è¯­è¨€é‡Œç”¨çš„ä¹Ÿå¾ˆå¤šï¼Œå…¶å®å°±æ˜¯ Brendan Gregg çš„ flamegraph.
ä»¥å‰å†…éƒ¨åšè¿‡ç±»ä¼¼çš„äº‹æƒ…ï¼Œä¸è¿‡ä»£ç æ˜¯ä¾µå…¥å¼çš„ï¼Œåœ¨è¿è¡Œæ—¶é€šè¿‡ signal, inspect, traceback ç­‰æ¨¡å—ï¼Œå®šæœŸæ‰“è°ƒç”¨æ ˆçš„ snapshot, è¾“å‡ºåˆ°æ–‡ä»¶ï¼Œè½¬æˆ svg çš„ flamegraph æ¥çœ‹ï¼Œä½†æ˜¯ overhead å¤ªé«˜ï¼Œåæ¥å¼ƒç”¨äº†ã€‚
        
        <a class="button is-link" href="https://blog.monsterxx03.com/2017/07/01/python-web-%E5%BA%94%E7%94%A8%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/" style="height:28px">
          Read more
          <span class="icon is-small">
            <i class="fa fa-angle-double-right"></i>
          </span>
        </a>
        
      </div>
    </article>
    
    <article>
      <div class="subtitle tags is-6 is-pulled-right">
        
        
<a class="subtitle is-6" href="/tags/aptly">#aptly</a>



  
  | <a class="subtitle is-6" href="/tags/fpm">#fpm</a>
  

        
      </div>
      <h2 class="subtitle is-6">June 23, 2017</h2>
      <h1 class="title"><a href="https://blog.monsterxx03.com/2017/06/23/build-deb-repository-with-fpm-aptly-and-s3/">Build deb repository with fpm , aptly and s3</a></h1>
      <div class="content">
        I&#8217;m lazy, I don&#8217;t want to be deb/rpm expert, I don&#8217;t want to maintain repo server. I want as less maintenance effort as possible. ğŸ™‚
Combine tools fpm, aptly with aws s3, we can do it.
Use fpm to convert python package to deb fpm can transform python/gem/npm/dir/&#8230; to deb/rpm/solaris/&#8230; packages
Example:
fpm -s python -t deb -m xyj.asmy@gmail.com --verbose -v 0.10.1 --python-pip /usr/local/pip Flask  It will transform Flask 0.
        
        <a class="button is-link" href="https://blog.monsterxx03.com/2017/06/23/build-deb-repository-with-fpm-aptly-and-s3/" style="height:28px">
          Read more
          <span class="icon is-small">
            <i class="fa fa-angle-double-right"></i>
          </span>
        </a>
        
      </div>
    </article>
    
    <article>
      <div class="subtitle tags is-6 is-pulled-right">
        
        
<a class="subtitle is-6" href="/tags/python">#python</a>



        
      </div>
      <h2 class="subtitle is-6">June 5, 2017</h2>
      <h1 class="title"><a href="https://blog.monsterxx03.com/2017/06/05/debug-python-performance-issue-with-pyflame/">Debug python performance issue with pyflame</a></h1>
      <div class="content">
        pyflame is an opensource tool developed by uber: https://github.com/uber/pyflame
It can take snapshots of running python process, combined with flamegraph.pl, can output flamegraph picture of python call stacks. Help analyze bottleneck of python program, needn&#8217;t inject any perf code into your application, and overhead is very low.
Basic Usage sudo pyflame -s 10 -x -r 0.001 $pid | ./flamegraph.pl &gt; perf.svg
 -s, how many seconds to run -r, sample rate (seconds)  Your output will be something like following:
        
        <a class="button is-link" href="https://blog.monsterxx03.com/2017/06/05/debug-python-performance-issue-with-pyflame/" style="height:28px">
          Read more
          <span class="icon is-small">
            <i class="fa fa-angle-double-right"></i>
          </span>
        </a>
        
      </div>
    </article>
    
    <article>
      <div class="subtitle tags is-6 is-pulled-right">
        
        
<a class="subtitle is-6" href="/tags/book">#book</a>



        
      </div>
      <h2 class="subtitle is-6">May 17, 2017</h2>
      <h1 class="title"><a href="https://blog.monsterxx03.com/2017/05/17/designing-data-intensive-application-reading-notes-part-2/">Designing data intensive application, reading notes, Part 2</a></h1>
      <div class="content">
        Chapter 4, 5, 6
Encoding formats xml, json, msgpack are text based encoding format, they can&#8217;t carry binary bytes (useless you encode them in base64, size grows 33%). And they cary schema definition with data, wast a lot of space.
thrift, protobuf are binary format, can take binary bytes, only carry data, the schema is defined with IDL(interface definition language). They have code generation tool to generate code to encode and decode data, along with check.
        
        <a class="button is-link" href="https://blog.monsterxx03.com/2017/05/17/designing-data-intensive-application-reading-notes-part-2/" style="height:28px">
          Read more
          <span class="icon is-small">
            <i class="fa fa-angle-double-right"></i>
          </span>
        </a>
        
      </div>
    </article>
    
    <article>
      <div class="subtitle tags is-6 is-pulled-right">
        
        
<a class="subtitle is-6" href="/tags/book">#book</a>



  
  | <a class="subtitle is-6" href="/tags/database">#Database</a>
  

        
      </div>
      <h2 class="subtitle is-6">May 4, 2017</h2>
      <h1 class="title"><a href="https://blog.monsterxx03.com/2017/05/04/designing-data-intensive-application-reading-notes-part-1/">Designing data intensive application, reading notes, Part 1</a></h1>
      <div class="content">
        Notes when reading chapter 2 &#8220;Data models and query languages&#8221;, chapter 3 &#8220;Storage and retrieval&#8221;


        
        <a class="button is-link" href="https://blog.monsterxx03.com/2017/05/04/designing-data-intensive-application-reading-notes-part-1/" style="height:28px">
          Read more
          <span class="icon is-small">
            <i class="fa fa-angle-double-right"></i>
          </span>
        </a>
        
      </div>
    </article>
    
    <article>
      <div class="subtitle tags is-6 is-pulled-right">
        
        
<a class="subtitle is-6" href="/tags/aws">#AWS</a>



        
      </div>
      <h2 class="subtitle is-6">April 21, 2017</h2>
      <h1 class="title"><a href="https://blog.monsterxx03.com/2017/04/21/infrastructure-as-code/">Infrastructure as Code</a></h1>
      <div class="content">
        Create virtual resource on AWS is very convenient, but how to manage them will be a problem when your size grow.
You will come to:
 How to explain the detail online settings for your colleagues (like: how our prod vpc is setup?what&#8217;s the DHCP option set?), navigate around AWS console is okay, but not convenient. Who did what to which resource at when? AWS have a service called Config, can be used to track this change, but if you want to make things as clear as viewing git log, still a lot of works to do.  Ideally, we should manage AWS resources like code, all changes kept in VCS, so called Infrastructure as Code.
I&#8217;ve tried three ways to do it:
 ansible CloudFormation terraform  In this article, I&#8217;ll compare them, however, the conclusion is to use terraform ğŸ™‚


        
        <a class="button is-link" href="https://blog.monsterxx03.com/2017/04/21/infrastructure-as-code/" style="height:28px">
          Read more
          <span class="icon is-small">
            <i class="fa fa-angle-double-right"></i>
          </span>
        </a>
        
      </div>
    </article>
    
    <article>
      <div class="subtitle tags is-6 is-pulled-right">
        
        
<a class="subtitle is-6" href="/tags/book">#book</a>



  
  | <a class="subtitle is-6" href="/tags/golang">#golang</a>
  

        
      </div>
      <h2 class="subtitle is-6">April 19, 2017</h2>
      <h1 class="title"><a href="https://blog.monsterxx03.com/2017/04/19/concurrency-in-go-reading-notes/">Concurrency in Go, Reading Notes</a></h1>
      <div class="content">
        A few notes taken when reading 

        
        <a class="button is-link" href="https://blog.monsterxx03.com/2017/04/19/concurrency-in-go-reading-notes/" style="height:28px">
          Read more
          <span class="icon is-small">
            <i class="fa fa-angle-double-right"></i>
          </span>
        </a>
        
      </div>
    </article>
    
    <article>
      <div class="subtitle tags is-6 is-pulled-right">
        
        
<a class="subtitle is-6" href="/tags/database">#Database</a>



  
  | <a class="subtitle is-6" href="/tags/mysql">#MySQL</a>
  

        
      </div>
      <h2 class="subtitle is-6">April 5, 2017</h2>
      <h1 class="title"><a href="https://blog.monsterxx03.com/2017/04/05/mysql-partition-table/">MySQL partition table</a></h1>
      <div class="content">
        Overview MySQL has buildin partition table support, which can help split data accross multi tables,
and provide a unified query interface as normal tables.
Benefit:
 Easy data management: If we need to archive old data, and our table is partitioned by datetime, we can drop old partition directly. Speed up query based on partition key(partitoin pruning)  Limit:
 For partition table, every unique key must use every column in table&#8217;s partition expression(include primary key) For innodb engine, paritioned table can&#8217;t have foreign key,and can&#8217;t have columns referenced by foreign keys. For MyISAM engine, mysql version &lt;= 5.6.5, DML operation will lock all partition as a whole.  

        
        <a class="button is-link" href="https://blog.monsterxx03.com/2017/04/05/mysql-partition-table/" style="height:28px">
          Read more
          <span class="icon is-small">
            <i class="fa fa-angle-double-right"></i>
          </span>
        </a>
        
      </div>
    </article>
    
    <article>
      <div class="subtitle tags is-6 is-pulled-right">
        
        
<a class="subtitle is-6" href="/tags/distribute">#distribute</a>



  
  | <a class="subtitle is-6" href="/tags/elasticsearch">#elasticsearch</a>
  

        
      </div>
      <h2 class="subtitle is-6">March 22, 2017</h2>
      <h1 class="title"><a href="https://blog.monsterxx03.com/2017/03/22/elasticsearch-cluster/">ElasticSearch cluster</a></h1>
      <div class="content">
        In this article, let&#8217;s talk about ElasticSearch&#8217;s cluster mode, which means multi nodes ElasticSearch.
Basic concepts cluster: A collection of server nodes with same cluster.name settings in elasticsearch.yaml
primary shards: Divide a index into multi parts(by default 5), shards of an index can be distributed over multi nodes. It enables scale index horizontally and make access to index parallelly(accross multi nodes).
replicas: backup for shards, also replicas can handle search requests, which means you can scale your search capacity horizontally via replicas.


        
        <a class="button is-link" href="https://blog.monsterxx03.com/2017/03/22/elasticsearch-cluster/" style="height:28px">
          Read more
          <span class="icon is-small">
            <i class="fa fa-angle-double-right"></i>
          </span>
        </a>
        
      </div>
    </article>
    
    <article>
      <div class="subtitle tags is-6 is-pulled-right">
        
        
<a class="subtitle is-6" href="/tags/bigtable">#bigtable</a>



  
  | <a class="subtitle is-6" href="/tags/distribute">#distribute</a>
  
  | <a class="subtitle is-6" href="/tags/paper">#paper</a>
  

        
      </div>
      <h2 class="subtitle is-6">December 11, 2016</h2>
      <h1 class="title"><a href="https://blog.monsterxx03.com/2016/12/11/bigtable-notes/">Bigtable notes</a></h1>
      <div class="content">
        æ‚ä¹±ç¬”è®°ï¼Œè¾…åŠ©è¯»paper.


        
        <a class="button is-link" href="https://blog.monsterxx03.com/2016/12/11/bigtable-notes/" style="height:28px">
          Read more
          <span class="icon is-small">
            <i class="fa fa-angle-double-right"></i>
          </span>
        </a>
        
      </div>
    </article>
    
  </div>
</section>
<section class="section">
  <div class="container">
    <nav class="level is-mobile">
      <div class="level-left">
        <div class="level-item">
          
          <a class="button" href="/categories/tech/page/2/">
            <span class="icon is-small is-marginless">
              <svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <polyline points="15 18 9 12 15 6"/>
    
  </svg>
            </span>
            Newer
          </a>
          
        </div>
      </div>
      <div class="level-right is-marginless">
        <div class="level-item">
          
          <a class="button" href="/categories/tech/page/4/">
            Older
            <span class="icon is-small is-marginless">
              <svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <polyline points="14 6 20 12 14 18"/>
    
  </svg>
            </span>
          </a>
          
        </div>
      </div>
    </nav>
  </div>
</section>

<section class="section">
  <div class="container has-text-centered">
    <p>monsterxx03</p>
    
  </div>
</section>


<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-98667627-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


</body>
</html>


